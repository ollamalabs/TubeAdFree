"use strict";class ContentScriptManager{async initialize(){await this.registerContentScripts(),chrome.storage.onChanged.addListener((t,e)=>{if("sync"===e&&t.adBlockStats){const e=t.adBlockStats.newValue,s=t.adBlockStats.oldValue;e&&s&&e.enabled!==s.enabled&&this.handleAdBlockerToggle(e.enabled)}})}async handleAdBlockerToggle(t){const e=await chrome.tabs.query({url:["*://*.youtube.com/*","*://*.youtu.be/*","*://*.yt.be/*"]});if(t){await this.registerContentScripts();for(const t of e)chrome.tabs.reload(t.id).catch(()=>{})}else{try{const t=["youtube-ad-blocker-main","youtube-ad-blocker-isolated"];await chrome.scripting.unregisterContentScripts({ids:t})}catch(t){}await this.registerContentScripts();for(const t of e)chrome.tabs.reload(t.id).catch(()=>{})}}async registerContentScripts(t={}){const e=(await chrome.storage.sync.get(["adBlockStats"])).adBlockStats||{enabled:!0},s=[];s.push({hosts:["*"],scripts:[{allFrames:!1,id:"ads-monitor-main",js:["content/utils/ads-monitor.js"],matches:["<all_urls>"],runAt:"document_end"}]}),e.enabled&&s.push({hosts:["youtube.com","youtu.be","yt.be"],scripts:[{allFrames:!1,id:"youtube-ad-blocker-main",js:["content/utils/sandbox.js","content/utils/json-filter.js","content/utils/interceptors.js","content/ads-blocker.js"],matches:["*://*.youtube.com/*","*://*.youtu.be/*","*://*.yt.be/*"],runAt:"document_start",world:"MAIN"},{allFrames:!0,id:"youtube-ad-blocker-isolated",js:["content/secure-context.js"],matches:["*://*.youtube.com/*","*://*.youtu.be/*","*://*.yt.be/*"],runAt:"document_start"}]});const a=s.flatMap(t=>t.scripts.map(t=>t.id)),o=await chrome.scripting.getRegisteredContentScripts({ids:a}),n=s.filter(e=>e.hosts.some(e=>t[e])).flatMap(t=>t.scripts).filter(t=>o.some(e=>e.id===t.id)).map(t=>t.id);n.length>0&&await chrome.scripting.unregisterContentScripts({ids:n});const i=s.flatMap(t=>t.scripts).filter(t=>!n.includes(t.id)&&!o.some(e=>e.id===t.id));if(i.length>0)try{await chrome.scripting.registerContentScripts(i)}catch(t){}}}const contentScriptManager=new ContentScriptManager;contentScriptManager.initialize().catch(t=>{});