document.addEventListener("DOMContentLoaded",async function(){const t=document.getElementById("logo"),e=document.getElementById("toggleSwitch"),a=document.getElementById("toggleStatus"),n=document.getElementById("totalBlocked"),o=document.getElementById("todayBlocked"),s=document.getElementById("timeSaved"),c=document.getElementById("activeStatus"),d=document.getElementById("lastUpdate"),l=document.getElementById("resetStats"),i=document.getElementById("reportIssue");t.src=chrome.runtime.getURL("assets/icon-128.png");const r={enabled:!0,totalBlocked:0,todayBlocked:0,lastResetDate:(new Date).toDateString(),installDate:Date.now(),lastUpdate:Date.now()};async function m(){return(await chrome.storage.sync.get(["adBlockStats"])).adBlockStats||r}async function u(t){t.lastUpdate=Date.now(),await chrome.storage.sync.set({adBlockStats:t})}async function g(){const t=await m(),l=(new Date).toDateString();t.lastResetDate!==l&&(t.todayBlocked=0,t.lastResetDate=l,await u(t)),t.enabled?(e.classList.add("active"),a.textContent="ON",c.innerHTML='<span class="status-indicator"></span>Active'):(e.classList.remove("active"),a.textContent="OFF",c.innerHTML='<span class="status-indicator disabled"></span>Disabled'),n.textContent=t.totalBlocked.toLocaleString(),o.textContent=t.todayBlocked.toLocaleString(),s.textContent=(function(t){const e=5*t,a=Math.floor(e/60),n=Math.floor(a/60),o=Math.floor(n/24);return o>0?`${o}d`:n>0?`${n}h`:a>0?`${a}m`:`${e}s`})(t.totalBlocked),d.textContent=(function(t){const e=Date.now()-t,a=Math.floor(e/1e3),n=Math.floor(a/60),o=Math.floor(n/60);return a<60?"Just now":n<60?`${n}m ago`:o<24?`${o}h ago`:new Date(t).toLocaleDateString()})(t.lastUpdate),chrome.action.setBadgeText({text:t.enabled?t.todayBlocked.toString():"OFF"}),chrome.action.setBadgeBackgroundColor({color:t.enabled?"#e52d28":"#6c757d"})}e.addEventListener("click",async function(){const t=await m();t.enabled=!t.enabled,await u(t),await g(),chrome.runtime.sendMessage({action:"toggleAdBlocker",enabled:t.enabled})}),l.addEventListener("click",async function(){const t=await m();t.totalBlocked=0,t.todayBlocked=0,t.lastUpdate=Date.now(),await u(t),await g(),l.textContent="Reseting...",setTimeout(()=>{l.textContent="Reset Stats"},1500)}),i.addEventListener("click",function(){chrome.tabs.create({url:"https://github.com/ollamalabs/tubeadfree/issues/new"})}),await g(),setInterval(g,5e3),chrome.runtime.onMessage.addListener((t,e,a)=>{"statsUpdated"===t.action&&g()})});